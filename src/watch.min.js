/**
 * DEVELOPED BY
 * GIL LOPES BUENO
 * gilbueno.mail@gmail.com
 *
 * WORKS WITH:
 * IE8*, IE 9+, FF 4+, SF 5+, WebKit, CH 7+, OP 12+, BESEN, Rhino 1.7+
 * For IE8 (and other legacy browsers) WatchJS will use dirty checking  
 *
 * FORK:
 * https://github.com/melanke/Watch.JS
 *
 * LICENSE: MIT
 */
"use strict";!function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):(window.WatchJS=t(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers)}(function(){function t(){O=null;for(var t=0;t<m.length;t++)m[t]();m.length=0}var e={noMore:!1,useDirtyCheck:!1},n=[],r=[],a=[],o=!1;try{o=Object.defineProperty&&Object.defineProperty({},"x",{})}catch(c){}var i=function(t){var e={};return t&&"[object Function]"==e.toString.call(t)},l=function(t){return"[object Array]"===Object.prototype.toString.call(t)},s=function(t){return"[object Object]"==={}.toString.apply(t)},u=function(t,e){var n=[],r=[];if("string"!=typeof t&&"string"!=typeof e){if(l(t))for(var a=0;a<t.length;a++)void 0===e[a]&&n.push(a);else for(var a in t)t.hasOwnProperty(a)&&e&&void 0===e[a]&&n.push(a);if(l(e))for(var o=0;o<e.length;o++)void 0===t[o]&&r.push(o);else for(var o in e)e.hasOwnProperty(o)&&t&&void 0===t[o]&&r.push(o)}return{added:n,removed:r}},f=function(t){if(null==t||"object"!=typeof t)return t;var e=t.constructor();for(var n in t)e[n]=t[n];return e},h=function(t,e,n,r){try{Object.observe(t,function(t){t.forEach(function(t){t.name===e&&r(t.object[t.name])})})}catch(a){try{Object.defineProperty(t,e,{get:n,set:function(t){r.call(this,t,!0)},enumerable:!0,configurable:!0})}catch(o){try{Object.prototype.__defineGetter__.call(t,e,n),Object.prototype.__defineSetter__.call(t,e,function(t){r.call(this,t,!0)})}catch(c){v(t,e,r)}}}},p=function(t,e,n){try{Object.defineProperty(t,e,{enumerable:!1,configurable:!0,writable:!1,value:n})}catch(r){t[e]=n}},v=function(t,e,n){r[r.length]={prop:e,object:t,orig:f(t[e]),callback:n}},d=function(){i(arguments[1])?g.apply(this,arguments):l(arguments[1])?w.apply(this,arguments):b.apply(this,arguments)},g=function(t,e,n,r){if("string"!=typeof t&&(t instanceof Object||l(t))){if(l(t)){if(C(t,"__watchall__",e,n),void 0===n||n>0)for(var a=0;a<t.length;a++)g(t[a],e,n,r)}else{var a,c=[];for(a in t)"$val"==a||!o&&"watchers"===a||Object.prototype.hasOwnProperty.call(t,a)&&c.push(a);w(t,c,e,n,r)}r&&H(t,"$$watchlengthsubjectroot",e,n)}},w=function(t,e,n,r,a){if("string"!=typeof t&&(t instanceof Object||l(t)))for(var o=0;o<e.length;o++){var c=e[o];b(t,c,n,r,a)}},b=function(t,e,n,r,a){"string"!=typeof t&&(t instanceof Object||l(t))&&(i(t[e])||(null!=t[e]&&(void 0===r||r>0)&&g(t[e],n,void 0!==r?r-1:r),C(t,e,n,r),a&&(void 0===r||r>0)&&H(t,e,n,r)))},_=function(){i(arguments[1])?j.apply(this,arguments):l(arguments[1])?y.apply(this,arguments):T.apply(this,arguments)},j=function(t,e){if(!(t instanceof String)&&(t instanceof Object||l(t)))if(l(t)){for(var n=["__watchall__"],r=0;r<t.length;r++)n.push(r);y(t,n,e)}else{var a=function(t){var n=[];for(var r in t)t.hasOwnProperty(r)&&(t[r]instanceof Object?a(t[r]):n.push(r));y(t,n,e)};a(t)}},y=function(t,e,n){for(var r in e)e.hasOwnProperty(r)&&T(t,e[r],n)},m=[],O=null,P=function(){return O||(O=setTimeout(t)),O},S=function(t){null==O&&P(),m[m.length]=t},W=function(){var t=i(arguments[2])?k:$;t.apply(this,arguments)},$=function(t,e,n,r){var a,o=null,c=-1,i=l(t),s=function(n,r,a,l){var s=P();if(c!==s&&(c=s,o={type:"update"},o.value=t,o.splices=null,S(function(){e.call(this,o),o=null})),i&&t===this&&null!==o){if("pop"===r||"shift"===r)a=[],l=[l];else if("push"===r||"unshift"===r)a=[a],l=[];else if("splice"!==r)return;o.splices||(o.splices=[]),o.splices[o.splices.length]={index:n,deleteCount:l?l.length:0,addedCount:a?a.length:0,added:a,deleted:l}}};a=1==n?void 0:0,g(t,s,a,r)},k=function(t,e,n,r,a){t&&e&&(b(t,e,function(t,e,o,c){var i={type:"update"};i.value=o,i.oldvalue=c,(r&&s(o)||l(o))&&$(o,n,r,a),n.call(this,i)},0),(r&&s(t[e])||l(t[e]))&&$(t[e],n,r,a))},C=function(t,n,r,a){var o=!1,c=l(t);t.watchers||(p(t,"watchers",{}),c&&D(t,function(e,r,o,c){if(I(t,e,r,o,c),0!==a&&o&&(s(o)||l(o))){var i,u,f,h,p=t.watchers[n];for((h=t.watchers.__watchall__)&&(p=p?p.concat(h):h),f=p?p.length:0,i=0;f>i;i++)if("splice"!==r)g(o,p[i],void 0===a?a:a-1);else for(u=0;u<o.length;u++)g(o[u],p[i],void 0===a?a:a-1)}})),t.watchers[n]||(t.watchers[n]=[],c||(o=!0));for(var i=0;i<t.watchers[n].length;i++)if(t.watchers[n][i]===r)return;if(t.watchers[n].push(r),o){var u=t[n],f=function(){return u},d=function(r,o){var c=u;if(u=r,0!==a&&t[n]&&(s(t[n])||l(t[n]))&&!t[n].watchers){var i,f=t.watchers[n].length;for(i=0;f>i;i++)g(t[n],t.watchers[n][i],void 0===a?a:a-1)}return E(t,n)?void F(t,n):void(e.noMore||c!==r&&(o?I(t,n,"set",r,c):x(t,n,"set",r,c),e.noMore=!1))};e.useDirtyCheck?v(t,n,d):h(t,n,f,d)}},x=function(t,e,n,r,a){if(void 0!==e){var o,c,i=t.watchers[e];(c=t.watchers.__watchall__)&&(i=i?i.concat(c):c),o=i?i.length:0;for(var l=0;o>l;l++)i[l].call(t,e,n,r,a)}else for(var e in t)t.hasOwnProperty(e)&&x(t,e,n,r,a)},J=["pop","push","reverse","shift","sort","slice","unshift","splice"],M=function(t,e,n,r){p(t,n,function(){var a,o,c,i,l=0;if("splice"===n){var s=arguments[0],u=s+arguments[1];for(c=t.slice(s,u),o=[],a=2;a<arguments.length;a++)o[a-2]=arguments[a];l=s}else o=arguments.length>0?arguments[0]:void 0;return i=e.apply(t,arguments),"slice"!==n&&("pop"===n?(c=i,l=t.length):"push"===n?l=t.length-1:"shift"===n?c=i:"unshift"!==n&&void 0===o&&(o=i),r.call(t,l,n,o,c)),i})},D=function(t,e){if(i(e)&&t&&!(t instanceof String)&&l(t))for(var n,r=J.length;r--;)n=J[r],M(t,t[n],n,e)},T=function(t,e,n){if(e){if(t.watchers[e])if(void 0===n)delete t.watchers[e];else for(var r=0;r<t.watchers[e].length;r++){var a=t.watchers[e][r];a==n&&t.watchers[e].splice(r,1)}}else delete t.watchers;K(t,e,n),L(t,e)},A=function(t,e){if(t.watchers){var n="__wjs_suspend__"+(void 0!==e?e:"");t.watchers[n]=!0}},E=function(t,e){return t.watchers&&(t.watchers.__wjs_suspend__||t.watchers["__wjs_suspend__"+e])},F=function(t,e){S(function(){delete t.watchers.__wjs_suspend__,delete t.watchers["__wjs_suspend__"+e]})},G=null,I=function(t,e,n,r,o){a[a.length]={obj:t,prop:e,mode:n,newval:r,oldval:o},null===G&&(G=setTimeout(q))},q=function(){var t=null;G=null;for(var e=0;e<a.length;e++)t=a[e],x(t.obj,t.prop,t.mode,t.newval,t.oldval);t&&(a=[],t=null)},z=function(){for(var t=0;t<n.length;t++){var e=n[t];if("$$watchlengthsubjectroot"===e.prop){var a=u(e.obj,e.actual);(a.added.length||a.removed.length)&&(a.added.length&&w(e.obj,a.added,e.watcher,e.level-1,!0),e.watcher.call(e.obj,"root","differentattr",a,e.actual)),e.actual=f(e.obj)}else{var a=u(e.obj[e.prop],e.actual);if(a.added.length||a.removed.length){if(a.added.length)for(var o=0;o<e.obj.watchers[e.prop].length;o++)w(e.obj[e.prop],a.added,e.obj.watchers[e.prop][o],e.level-1,!0);x(e.obj,e.prop,"differentattr",a,e.actual)}e.actual=f(e.obj[e.prop])}}var c,i;if(r.length>0)for(var t=0;t<r.length;t++)c=r[t],i=c.object[c.prop],B(c.orig,i)||(c.orig=f(i),c.callback(i))},B=function(t,e){var n,r=!0;if(t!==e)if(s(t)){for(n in t)if((o||"watchers"!==n)&&t[n]!==e[n]){r=!1;break}}else r=!1;return r},H=function(t,e,r,a){var o;o=f("$$watchlengthsubjectroot"===e?t:t[e]),n.push({obj:t,prop:e,actual:o,watcher:r,level:a})},K=function(t,e,r){for(var a=0;a<n.length;a++){var o=n[a];o.obj==t&&(e&&o.prop!=e||r&&o.watcher!=r||n.splice(a--,1))}},L=function(t,e){for(var n,a=0;a<r.length;a++){var o=r[a],c=o.object.watchers;n=o.object==t&&(!e||o.prop==e)&&c&&(!e||!c[e]||0==c[e].length),n&&r.splice(a--,1)}};return setInterval(z,50),e.watch=d,e.unwatch=_,e.callWatchers=x,e.suspend=A,e.onChange=W,e});